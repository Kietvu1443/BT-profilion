<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biểu Đồ Kỹ Năng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

 <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fruktur&display=swap" rel="stylesheet">

<script>
  tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'classic-bg': '#EADECF', 
                        'classic-border': '#4A372D', 
                        'classic-accent': '#735745', 

                        'dark-bg': '#333A40',
                        'dark-border': '#F8F5F1',
                        'dark-accent': '#46034F', 
                        'skill-hover': '#46034F', // Đảm bảo màu tím đậm

                        'chart-1': '#A63F3F', // Màu đỏ đất
                        'chart-2': '#4A372D', // Màu nâu đậm
                        'chart-3': '#735745', // Màu nâu nhạt
                        'chart-4': '#D4AA7D', // Màu be đậm
                        'chart-5': '#C5C59C', // Màu xanh rêu nhạt
                        'sub-item-bg': '#F0EBE5', // Nền cho mục con
                    },
                    fontFamily: {
                      sans: ['Fruktur', 'sans-serif'],
                      serif: ['Fruktur', 'serif'],
                    },
                }
            }
        }
</script>
   
    <style>
  body { 
            font-family: 'Fruktur', system-ui !important; 
            background-image: url('classic_light_ver.jpg'); 
            background-size: cover; 
            background-repeat: no-repeat; 
            background-attachment: fixed; 
            transition: background-image 0.4s ease, color 0.4s ease; 
        }
        
        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animated-block {
            animation: fadeInSlideUp 0.6s ease-out both;
        }

        .classic-frame-chart {
            border: 3px solid #735745;
            border-radius: 8px;
            background-color: #F8F5F1;
            padding: 1rem;
            position: relative;
            transition: all 0.2s ease-in-out;
        }

        .classic-frame-chart::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border: 1px dashed #9E7E63;
            border-radius: 5px;
            pointer-events: none;
        }

        .legend-item:hover {
            transform: scale(1.02);
            background-color: #f0f0e0;
            box-shadow: 1px 1px 0 0 #735745;
        }

        /* Ẩn nội dung chi tiết theo mặc định */
        .sub-items-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out;
        }

        /* Hiển thị nội dung chi tiết khi được chạm */
        .sub-items-container.active {
            max-height: 500px; 
            padding-top: 0.5rem;
        }
        
        .sub-item {
            border-left: 3px solid var(--color); 
            background-color: #F0EBE5;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-top: 0.25rem;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        .sub-item:hover {
            background-color: #EADECF;
        }

/*nút home*/
.classic-frame-detail {
    border: 3px solid #65330a;
    border-radius: 8px;
    background-color: #F8F5F1;
    padding: 1rem;
    position: relative;
    transition: all 0.4s ease;
}

.classic-frame-detail::before {
    content: '';
    position: absolute;
    top: 4px;
    left: 4px;
    right: 4px;
    bottom: 4px;
    border: 1px dashed #9E7E63;
    border-radius: 5px;
    pointer-events: none;
    transition: border-color 0.4s ease;
}

.dark-theme .classic-frame-detail {
    border-color: #F8F5F1;
    background-color: #2f195c40; 
    color: #F8F5F1;
}

.dark-theme .classic-frame-detail::before {
    border-color: #F8F5F1; 
}

        body.dark-theme {
            background-image: url('classic_dark_ver.jpg'); 
            color: #F8F5F1;
        }

        .dark-theme .classic-frame-chart {
            border-color: #F8F5F1;
            background-color: #2f195c40; 
            color: #F8F5F1;
        }

        .dark-theme .classic-frame-chart::before {
            border-color: #F8F5F1; 
        }

        .dark-theme .text-classic-border,
        .dark-theme a {
             color: #F8F5F1 !important; 
        }

        .dark-theme .text-lg.font-bold.text-classic-accent {
            color: #F8F5F1 !important;
        }

        .dark-theme .sub-item {
            background-color: #46034f40; 
            color: #F8F5F1;
            border-color: #F8F5F1; 
        }
        .dark-theme .sub-item:hover {
            background-color: #46034f60;
        }


        .dark-theme .legend-item:hover {
            transform: none; 
            box-shadow: none; 
        }

        body.dark-theme .skill-link:hover,
        body.dark-theme .skill-link:focus, 
        body.dark-theme .skill-link:active,
        body.dark-theme .legend-item:hover,
        body.dark-theme .legend-item:focus,
        body.dark-theme .legend-item:active { 
            background-color: #46034F !important; 
            color: #F8F5F1 !important;
            border-color: #F8F5F1 !important;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            z-index: 50;
        }
        .switch #theme-toggle {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider.round {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f9f8f7; 
            transition: 0.4s;
            border-radius: 34px; 
            overflow: hidden;
            border: 1px solid #735745;
        }

        .sun-moon {
            position: absolute;
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            border-radius: 50%;
            background-color: #FEE715; 
            transition: 0.4s;
            box-shadow: 0 0 5px rgba(249, 68, 32, 0.899); 
            background-image: none; 
        }

        #theme-toggle:checked + .slider.round {
            background-color: #333A40; 
            border-color: #F8F5F1;
        }
        #theme-toggle:checked + .slider.round .sun-moon {
            transform: translateX(26px); 
            background-color: white; 
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); 
            background-image: radial-gradient(circle at 120% 50%, #333A40 60%, transparent 60%);
        }
    </style>

</head>
<body class="min-h-screen p-6 sm:p-10 font-serif bg-classic-bg">

    <div class="fixed top-4 right-4 z-50">
        <label class="switch">
            <input id="theme-toggle" type="checkbox" /> 
            <div class="slider round">
                <div class="sun-moon">
                </div>
            </div>
        </label>
    </div>
    
    <div class="max-w-7xl mx-auto">
       <header class="mb-12">
    <a href="#" class="inline-block classic-frame-chart px-3 py-2 text-classic-border hover:bg-classic-border hover:text-white transition duration-200 animated-block skill-link mr-2" style="animation-delay: 0.1s;"> 
        <i data-lucide="home" class="w-5 h-5"></i>
    </a>

    <a href="thongtin.html" class="inline-block classic-frame-chart px-4 py-2 text-classic-border text-sm hover:bg-classic-border hover:text-white transition duration-200 animated-block skill-link" style="animation-delay: 0.1s;">
    Back
    </a>

    <h1 class="text-4xl md:text-5xl font-bold text-classic-border mt-6 tracking-wider animated-block" style="animation-delay: 0.2s;">
     BIỂU ĐỒ 
    </h1>
</header>

        <div class="flex flex-col lg:flex-row-reverse lg:space-x-8 lg:space-x-reverse">
            <div class="lg:w-1/2">
            
                <h2 class="text-2xl font-bold text-classic-border animated-block" style="animation-delay: 0.5s;">
                    </h2>
                <div id="chart-legend" class="space-y-3">
                    </div>
            </div>

            <div class="lg:w-1/2 animated-block" style="animation-delay: 0.7s;">
                <div class="classic-frame-chart p-6">
                    <canvas id="skillChart" class="max-w-full h-auto"></canvas>
                </div>
            </div>
        </div>
    </div>

<script> 
    
      
        
        // Dữ liệu mẫu 
        const skillData = [
            {
                label: 'Ngoại ngữ',
                value: 25,
                color: '#A63F3F',
                icon: 'globe',
                subItems: [
                    { name: 'Tiếng Anh', level: '70%' },
                    { name: 'Tiếng Hàn', level: '10%' },
                    { name: 'Tiếng Trung', level: '40%' },
                ]
            },
            {
                label: 'Ngôn ngữ máy tính',
                value: 20,
                color: '#735745',
                icon: 'laptop-2',
                subItems: [
                    { name: 'C#', level: '50%' },
                    { name: 'C++', level: '50%' },
                    { name: 'Java', level: '30%' },
                ]
            },
            {
                label: 'Tiến độ học trên lớp',
                value: 30,
                color: '#9E7E63',
                icon: 'clock',
                subItems: [
                    { name: 'Điểm danh', level: '70%' },
                    { name: 'Tích giờ thư viện', level: '20%' },
                    { name: 'Tự học', level: '10%' },
                ]
            },
            {
                label: 'Làm việc nhóm',
                value: 15,
                color: '#D4AA7D',
                icon: 'users',
                subItems: [
                    { name: 'Giáo viên đánh giá', level: '60%' },
                    { name: 'Thành viên đánh giá', level: '80%' },
                    { name: 'Tự đánh giá', level: '50%' }
                ]
            },
            {
                label: 'Cá nhân',
                value: 10,
                color: '#C5C59C',
                icon: 'user-square',
                subItems: [ 
                     { name: 'Ưu điểm', level: '65%' },
                     { name: 'Nhược điểm', level: '35%' },
                           ]
            }
        ];

        // Chuẩn bị dữ liệu cho Chart.js
        const chartData = {
            labels: skillData.map(item => item.label),
            datasets: [{
                data: skillData.map(item => item.value), // Tổng 100%
                backgroundColor: skillData.map(item => item.color),
                hoverOffset: 10,
                borderWidth: 2,
                borderColor: '#F8F5F1'
            }]
        };

        // Cấu hình Chart.js
        const config = {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: true,

            animation: { // xoay khi vừa dô 
            animateRotate: true, // Bật hiệu ứng xoay
            animateScale: false, // Tắt hiệu ứng scale (phóng to từ giữa ra)
            duration: 1500, // Thời gian xoay
            easing: 'easeInOutQuad' // Kiểu chuyển động
        },

                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed + '%';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        };

        // Hàm xử lý việc mở/đóng menu con
        function toggleSubItems(event) {
            const itemElement = event.currentTarget;
            const subContainer = itemElement.nextElementSibling;
            
            // Chỉ xử lý nếu có mục con
            if (subContainer && subContainer.classList.contains('sub-items-container')) {
                subContainer.classList.toggle('active');
                
                // Thay đổi icon mũi tên
                const icon = itemElement.querySelector('[data-lucide="chevron-down"], [data-lucide="chevron-up"]');
                if (icon) {
                    if (subContainer.classList.contains('active')) {
                        icon.setAttribute('data-lucide', 'chevron-up');
                    } else {
                        icon.setAttribute('data-lucide', 'chevron-down');
                    }
                    // Re-render icon
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                }
            }
        }

        // Hàm tạo Legend tùy chỉnh
        function createCustomLegend(data) {
            const legendContainer = document.getElementById('chart-legend');
            
            data.forEach((item, index) => {
                const iconName = item.icon || 'circle';
                const hasSubItems = item.subItems && item.subItems.length > 0;
                
                const itemWrapper = document.createElement('div');
                itemWrapper.style.animationDelay = (0.9 + index * 0.2) + 's';
                
                // 2. Tạo mục chính (Header)
                const mainItem = document.createElement('div');
                mainItem.className = 'legend-item classic-frame-chart p-3 flex items-center justify-between cursor-pointer transition duration-200 animated-block skill-link'; 
                
                if (hasSubItems) {
                    // Nếu có mục con, thêm sự kiện click
                    mainItem.addEventListener('click', toggleSubItems);
                }

                // Chú ý: Lớp text-lg font-bold text-classic-accent là nơi hiển thị phần trăm.
                mainItem.innerHTML = `
                    <div class="flex items-center space-x-3 text-classic-border">
                        <div style="background-color: ${item.color};" class="w-5 h-5 rounded-full border border-classic-border flex items-center justify-center">
                            <i data-lucide="${iconName}" class="w-3 h-3 text-white"></i>
                        </div>
                        <span class="font-medium">${item.label}</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="text-lg font-bold text-classic-accent">${item.value}%</span>
                        ${hasSubItems ? `<i data-lucide="chevron-down" class="w-4 h-4 text-classic-border transition-transform"></i>` : ''}
                    </div>
                `;
                itemWrapper.appendChild(mainItem);
                
                // 3. Tạo container cho các mục con
                if (hasSubItems) {
                    const subContainer = document.createElement('div');
                    subContainer.className = 'sub-items-container space-y-1';
                    
                    item.subItems.forEach(sub => {
                        const subItem = document.createElement('div');
                        subItem.className = 'sub-item text-classic-border flex justify-between';
                        subItem.style.setProperty('--color', item.color); 
                        subItem.innerHTML = `
                            <span>${sub.name}</span>
                            <span class="font-semibold text-sm">${sub.level}</span>
                        `;
                        subContainer.appendChild(subItem);
                    });

                    itemWrapper.appendChild(subContainer);
                }

                legendContainer.appendChild(itemWrapper);
            });
        }
        
        //CHUYỂN THEME
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        const loadTheme = () => {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'dark') {
                body.classList.add('dark-theme');
                if (themeToggle) themeToggle.checked = true;
            } else {
                body.classList.remove('dark-theme');
                if (themeToggle) themeToggle.checked = false;
            }
        };

        const setupThemeToggle = () => {
            if (themeToggle) {
                themeToggle.addEventListener('change', function() {
                    if (this.checked) {
                        body.classList.add('dark-theme');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        body.classList.remove('dark-theme');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        };

        window.onload = function () {
            const ctx = document.getElementById('skillChart').getContext('2d');
            new Chart(ctx, config);
            createCustomLegend(skillData);
            loadTheme(); 
            setupThemeToggle(); 
            if (typeof lucide !== 'undefined') {
                 lucide.createIcons();
            }
        };
</script>
</body>
</html>